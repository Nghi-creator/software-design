{{#section "css"}}
<link rel="stylesheet" href="/static/css/product/list.css">
{{/section}}

{{#section "js"}}
<script>
  // Real-time countdown timer
  function updateCountdowns() {
    const countdownElements = document.querySelectorAll('.countdown-timer');

    countdownElements.forEach(element => {
      const endDate = new Date(element.getAttribute('data-end-date'));
      const now = new Date();
      const timeLeft = endDate - now;

      if (timeLeft <= 0) {
        element.textContent = 'Ended';
        element.classList.remove('text-danger');
        element.classList.add('text-muted');
        return;
      }

      // Calculate time units
      const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

      // Format output
      let timeString = '';
      if (days > 0) {
        timeString = `${days}d ${hours}h ${minutes}m`;
      } else if (hours > 0) {
        timeString = `${hours}h ${minutes}m ${seconds}s`;
      } else if (minutes > 0) {
        timeString = `${minutes}m ${seconds}s`;
      } else {
        timeString = `${seconds}s`;
      }

      element.textContent = timeString;

      // Change color based on urgency
      if (days === 0 && hours < 1) {
        element.classList.remove('text-danger');
        element.classList.add('text-danger', 'fw-bold');
      }
    });
  }

  // Update immediately and then every second
  document.addEventListener('DOMContentLoaded', function () {
    updateCountdowns();
    setInterval(updateCountdowns, 1000);
  });
</script>
{{/section}}

<div class="container-fluid mt-4 mb-5">

  <div class="row">
    {{!-- LEFT SIDEBAR --}}
    <aside class="col-md-3 mb-4">
      <div class="sidebar-widget">
        <h5 class="widget-title text-uppercase mb-4 pb-2"
          style="border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
          Sort By
        </h5>

        <div class="mb-3">
          <a href="?{{#if categoryId}}catid={{categoryId}}{{else}}q={{q}}{{/if}}&page={{currentPage}}&logic={{logic}}"
            class="d-block text-decoration-none {{#unless sort}}fw-bold text-primary{{else}}text-dark{{/unless}} mb-2">
            <i class="bi bi-list-ul"></i> Default
          </a>
          <a href="?{{#if categoryId}}catid={{categoryId}}{{else}}q={{q}}{{/if}}&page={{currentPage}}&sort=price_asc&logic={{logic}}"
            class="d-block text-decoration-none {{#if (eq sort 'price_asc')}}fw-bold text-primary{{else}}text-dark{{/if}} mb-2">
            <i class="bi bi-sort-down"></i> Price: Low to High
          </a>
          <a href="?{{#if categoryId}}catid={{categoryId}}{{else}}q={{q}}{{/if}}&page={{currentPage}}&sort=price_desc&logic={{logic}}"
            class="d-block text-decoration-none {{#if (eq sort 'price_desc')}}fw-bold text-primary{{else}}text-dark{{/if}} mb-2">
            <i class="bi bi-sort-up"></i> Price: High to Low
          </a>
          <a href="?{{#if categoryId}}catid={{categoryId}}{{else}}q={{q}}{{/if}}&page={{currentPage}}&sort=newest&logic={{logic}}"
            class="d-block text-decoration-none {{#if (eq sort 'newest')}}fw-bold text-primary{{else}}text-dark{{/if}} mb-2">
            <i class="bi bi-clock"></i> Newest First
          </a>
          <a href="?{{#if categoryId}}catid={{categoryId}}{{else}}q={{q}}{{/if}}&page={{currentPage}}&sort=oldest&logic={{logic}}"
            class="d-block text-decoration-none {{#if (eq sort 'oldest')}}fw-bold text-primary{{else}}text-dark{{/if}}">
            <i class="bi bi-clock-history"></i> Oldest First
          </a>
        </div>
      </div>
    </aside>

    {{!-- RIGHT CONTENT --}}
    <div class="col-md-9">

      {{!-- HEADER --}}
      <div class="display-header d-flex justify-content-between align-items-center pb-3">
        <div>
          <h2 class="display-7 text-dark text-uppercase mb-0">
            {{#if categoryId}}
            {{#if categoryName}}
            {{categoryName}}
            {{else}}
            PRODUCT LIST
            {{/if}}
            {{else}}
            SEARCH RESULTS
            {{/if}}
          </h2>
          <div class="mt-2">
            {{#if (eq totalCount 0)}}
            <small class="text-muted">No products found.</small>
            {{else}}
            <small class="text-muted">
              Showing <span class="fw-bold text-dark">{{from}}</span> â€“ <span class="fw-bold text-dark">{{to}}</span> of
              <span class="fw-bold text-dark">{{totalCount}}</span> results
            </small>
            {{/if}}
          </div>
        </div>
      </div>
      <hr class="my-2 mb-4">

      {{!-- CONTENT --}}
      {{#if (eq products.length 0)}}
      <div class="alert alert-info text-center py-5 rounded">
        <h5 class="mb-3">No products found</h5>
        <a href="/" class="btn btn-primary">Back to Home</a>
      </div>
      {{else}}

      <div class="row g-4">
        {{#each products}}
        <div class="col-md-6 col-lg-4">
          {{> product-card this isAuthenticated=../isAuthenticated isWatchlistView=false}}
        </div>
        {{/each}}
      </div>

      {{!-- PAGINATION --}}
      {{> pagination}}
      {{/if}}
    </div>
  </div>
</div>