{{#section "css"}}
<link rel="stylesheet" href="/static/css/product/list.css">
{{/section}}

{{#section "js"}}
<script>
  // Real-time countdown timer
  function updateCountdowns() {
    const countdownElements = document.querySelectorAll('.countdown-timer');

    countdownElements.forEach(element => {
      const endDate = new Date(element.getAttribute('data-end-date'));
      const now = new Date();
      const timeLeft = endDate - now;

      if (timeLeft <= 0) {
        element.textContent = 'Ended';
        element.classList.remove('text-danger');
        element.classList.add('text-muted');
        return;
      }

      // Calculate time units
      const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

      // Format output
      let timeString = '';
      if (days > 0) {
        timeString = `${days}d ${hours}h ${minutes}m`;
      } else if (hours > 0) {
        timeString = `${hours}h ${minutes}m ${seconds}s`;
      } else if (minutes > 0) {
        timeString = `${minutes}m ${seconds}s`;
      } else {
        timeString = `${seconds}s`;
      }

      element.textContent = timeString;

      // Change color based on urgency
      if (days === 0 && hours < 1) {
        element.classList.remove('text-danger');
        element.classList.add('text-danger', 'fw-bold');
      }
    });
  }

  // Update immediately and then every second
  document.addEventListener('DOMContentLoaded', function () {
    updateCountdowns();
    setInterval(updateCountdowns, 1000);
  });
</script>
{{/section}}

<div class="container-fluid mt-4 mb-5">
  <div class="row">

    {{!-- 1. LEFT SIDEBAR (Giống vwAccount/profile.handlebars) --}}
    <div class="col-md-3 mb-4">
      {{> client-sidebar activeSection='watchlist'}}
    </div>

    {{!-- 2. RIGHT CONTENT --}}
    <div class="col-md-9">

      {{!-- HEADER --}}
      <div class="display-header d-flex justify-content-between align-items-center pb-3">
        <div>
          <h2 class="display-7 text-dark text-uppercase mb-0">
            MY WATCHLIST
          </h2>

          <div class="mt-2">
            {{#if (eq totalCount 0)}}
            <small class="text-muted">No products found.</small>
            {{else}}
            <small class="text-muted">
              Showing <span class="fw-bold text-dark">{{from}}</span> – <span class="fw-bold text-dark">{{to}}</span> of
              <span class="fw-bold text-dark">{{totalCount}}</span> results
            </small>
            {{/if}}
          </div>
        </div>
      </div>
      <hr class="my-2 mb-4">

      {{!-- CONTENT --}}
      {{#if (eq products.length 0)}}
      <div class="alert alert-info text-center py-5 rounded">
        <h5 class="mb-3">Your watchlist is empty</h5>
        <a href="/" class="btn btn-primary">Home</a>
      </div>
      {{else}}

      {{!-- PRODUCT GRID --}}
      <div class="row g-4">
        {{#each products}}
        <div class="col-md-6 col-lg-4">
          {{> product-card this isAuthenticated=../isAuthenticated isWatchlistView=true}}
        </div>
        {{/each}}
      </div>

      {{!-- PAGINATION --}}
      {{> pagination}}
      {{/if}}

    </div>
  </div>
</div>