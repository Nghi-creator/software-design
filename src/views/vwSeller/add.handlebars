{{#section "css"}}
<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<!-- Uppy CSS -->
<link href="https://releases.transloadit.com/uppy/v5.2.0/uppy.min.css" rel="stylesheet">
<!-- Seller Custom CSS -->
<link rel="stylesheet" href="/static/css/seller/seller.css">
<link rel="stylesheet" href="/static/css/seller/seller-add.css">
{{/section}}

<div class="container-fluid mt-4 mb-5">
  <div class="row">

    {{!-- LEFT SIDEBAR --}}
    <div class="col-lg-3 mb-4">
      {{> seller-sidebar activeSection='active-products'}}
    </div>

    {{!-- RIGHT CONTENT --}}
    <div class="col-lg-9">

      {{!-- HEADER --}}
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="display-6 text-dark mb-1">Add New Product</h2>
          <p class="text-muted">Create a new auction product</p>
        </div>
        <a href="/seller/products" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Back to Products
        </a>
      </div>

      {{!-- ERROR/SUCCESS MESSAGES --}}
      {{#if error_message}}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>{{error_message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
      {{/if}}

      {{#if success_message}}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>{{success_message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
      {{/if}}

      {{!-- FORM --}}
      <form id="addProductForm" method="POST" action="/seller/products/add" enctype="application/x-www-form-urlencoded">

        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header text-white" style="background-color: #72AEC8;">
            <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Basic Information</h5>
          </div>
          <div class="card-body">

            {{!-- Product Name --}}
            <div class="mb-3">
              <label for="productName" class="form-label required">Product Name</label>
              <input type="text" class="form-control" id="productName" name="name" maxlength="255">
              <div class="invalid-feedback" id="productNameError">Please enter a product name.</div>
            </div>

            {{!-- Category --}}
            <div class="mb-3">
              <label for="category" class="form-label required">Category</label>
              <select class="form-select" id="category" name="category_id">
                <option value="">Select a category</option>
                {{#each lcCategories1}}
                <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
                {{#each lcCategories2}}
                <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
              </select>
              <div class="invalid-feedback" id="categoryError">Please select a category.</div>
            </div>

            {{!-- Description --}}
            <div class="mb-3">
              <label for="description" class="form-label">Product Description</label>
              <div id="editor-container"></div>
              <input type="hidden" name="description" id="descriptionInput">
              <div class="invalid-feedback" id="descriptionError">Please enter a product description.</div>
            </div>

          </div>
        </div>

        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header text-white" style="background-color: #72AEC8;">
            <h5 class="mb-0"><i class="bi bi-currency-dollar me-2"></i>Pricing & Duration</h5>
          </div>
          <div class="card-body">

            {{!-- Starting Price --}}
            <div class="mb-3">
              <label for="startPrice" class="form-label required">Starting Price (VND)</label>
              <input class="form-control" id="startPrice" name="start_price">
              <div class="invalid-feedback" id="startPriceError">Please enter a valid starting price (minimum 1,000
                VND).</div>
            </div>

            {{!-- Step Price --}}
            <div class="mb-3">
              <label for="stepPrice" class="form-label required">Bid Step (VND)</label>
              <input class="form-control" id="stepPrice" name="step_price">
              <small class="form-text text-muted">Minimum amount each bid must increase.</small>
              <div class="invalid-feedback" id="stepPriceError">Please enter a valid bid step (minimum 1,000 VND).</div>
            </div>
            {{!-- Buy Now Price --}}
            <div class="mb-3">
              <label for="buyNowPrice" class="form-label">Buy Now Price (VND) - Optional</label>
              <input class="form-control" id="buyNowPrice" name="buy_now_price">
              <small class="form-text text-muted">Leave empty if you don't want to enable "Buy Now" option.</small>
              <div class="invalid-feedback" id="buyNowPriceError">Buy now price must be greater than starting price.
              </div>
            </div>

            {{!-- Auction End Date/Time --}}
            <div class="mb-3">
              <label for="endDate" class="form-label required">Auction End Date/Time</label>
              <input type="datetime-local" class="form-control" id="endDate" name="end_date_display"
                style="max-width: 300px;">
              <input type="hidden" id="endDateFormatted" name="end_date">
              <div class="invalid-feedback" id="endDateError" style="display: none;">Please select a valid end date and
                time.</div>
            </div>

            {{!-- Created At (Hidden) --}}
            <input type="hidden" id="createdAt" name="created_at">

          </div>
        </div>

        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header text-white" style="background-color: #5a92ab;">
            <h5 class="mb-0"><i class="bi bi-images me-2"></i>Product Images</h5>
          </div>
          <div class="card-body">

            {{!-- Main Thumbnail --}}
            <div class="mb-4">
              <label class="form-label required">Main Thumbnail (1 image)</label>
              <div id="uppy-thumbnail"></div>
              <div class="invalid-feedback" id="thumbnailError">Please upload a main thumbnail image.</div>
              <small class="form-text text-muted d-block mt-2">
                <i class="bi bi-info-circle"></i> This will be the primary image displayed for your product.
              </small>
              <input type="hidden" name="thumbnail" id="txt_thumbnail">
            </div>

            <hr class="my-4">

            {{!-- Sub Images --}}
            <div class="mb-3">
              <label class="form-label required">Additional Images (Minimum 3 images)</label>
              <div id="uppy-subimages"></div>
              <div class="invalid-feedback" id="subImagesError">Please upload at least 3 additional images.</div>
              <small class="form-text text-muted d-block mt-2">
                <i class="bi bi-info-circle"></i> These images will be shown in the product gallery.
              </small>
              <input type="hidden" name="imgs_list" id="txt_imgs_list">
            </div>

          </div>
        </div>

        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header text-white" style="background-color: #89c4dc;">
            <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Auction Settings</h5>
          </div>
          <div class="card-body">

            {{!-- Auto-extend --}}
            <div class="mb-3">
              <input type="hidden" name="auto_extend" value="0">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="autoExtend" name="auto_extend" value="1">
                <label class="form-check-label" for="autoExtend">
                  <strong>Enable Auto-extend</strong>
                </label>
              </div>
            </div>

            {{!-- Allow New Bidders --}}
            <div class="mb-3">
              <input type="hidden" name="allow_new_bidders" value="0">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="allowNewBidders" name="allow_new_bidders" value="1"
                  checked>
                <label class="form-check-label" for="allowNewBidders">
                  <strong>Allow New Bidders</strong>
                </label>
              </div>
            </div>

          </div>
        </div>

        {{!-- Submit Buttons --}}
        <div class="d-flex gap-2 mb-4">
          <button type="submit" class="btn btn-lg px-5" style="background-color: #72AEC8; color: white; border: none;">
            <i class="bi bi-check-circle me-2"></i>Create Product
          </button>
          <a href="/seller/products" class="btn btn-outline-secondary btn-lg px-4">
            <i class="bi bi-x-circle me-2"></i>Cancel
          </a>
        </div>

      </form>

    </div>
  </div>
</div>

{{#section "js"}}
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/cleave.js@1.6.0/dist/cleave.min.js"></script>
<script type="importmap">
{
  "imports": {
    "@uppy/core": "https://releases.transloadit.com/uppy/v5.2.0/uppy.min.mjs",
    "@uppy/dashboard": "https://releases.transloadit.com/uppy/v5.2.0/dashboard.min.mjs",
    "@uppy/xhr-upload": "https://releases.transloadit.com/uppy/v5.2.0/xhr-upload.min.mjs"
  }
}
</script>
<script type="module">
  import { Uppy, Dashboard, XHRUpload } from "https://releases.transloadit.com/uppy/v5.2.0/uppy.min.mjs"
  import "/static/js/seller/seller-add.js";

  $(document).ready(function () {
    SellerAdd.init();
  });
</script>
{{/section}}